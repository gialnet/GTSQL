-- PARA LAS MODIFICACIONES DESDE EL FIN98 PERO SOLO LOS QUE TENGAN CONVENIO DE COLABORACION
-- VARPAD; SOLO SE PUEDEN MODIFICAR DATOS JURIDICOS.

CREATE OR REPLACE PROCEDURE MODI_VARPAD_FIN98(
	xID				IN	INTEGER,
	xNIF				IN	CHAR,
	xNOMBRE			IN	CHAR,
	xTIPO_VIA_FISCAL		IN	CHAR,
	xNOMBRE_VIA_FISCAL	IN	CHAR,
	xPRIMER_NUMERO_FISCAL	IN	CHAR,
	xPRIMERA_LETRA_FISCAL	IN	CHAR,
	xSEGUNDO_NUMERO_FISCAL	IN	CHAR,
	xSEGUNDA_LETRA_FISCAL	IN	CHAR,
	xKILOMETRO_FISCAL		IN	CHAR,
	xBLOQUE_FISCAL		IN	CHAR,
	xTEXTO_DIRECCION_FISCAL	IN	CHAR,
	xESCALERA_FISCAL		IN	CHAR,
	xPLANTA_FISCAL		IN	CHAR,
	xPUERTA_FISCAL		IN	CHAR,
	xCOD_POSTAL_FISCAL	IN	CHAR,
	xAPARTADO_CORREOS		IN	CHAR,
	xPAIS				IN	CHAR,
	xPROVINCIA			IN	CHAR,
	xMUNICIPIO_FISCAL		IN	CHAR,
	xYEAR_EXPEDIENTE		IN	CHAR,
	xREF_EXPEDIENTE		IN	CHAR,
	xCOD_ENTIDAD_COLA		IN	CHAR)
	
AS

	TYPE reg_cargo IS RECORD
	     (ID IBI_CARGO_FURB.ID%TYPE,
		MUNICIPIO IBI_CARGO_FURB.MUNICIPIO%TYPE,
		COD_DELEGACION_MEH IBI_CARGO_FURB.COD_DELEGACION_MEH%TYPE,
		COD_GERENCIA IBI_CARGO_FURB.COD_GERENCIA%TYPE,
		COD_MUNICIPIO IBI_CARGO_FURB.COD_MUNICIPIO%TYPE,	
		ID_FINCA IBI_CARGO_FURB.ID_FINCA%TYPE,				
		REF_CATASTRAL IBI_CARGO_FURB.REF_CATASTRAL%TYPE,
		NUM_CARGO IBI_CARGO_FURB.NUM_CARGO%TYPE,
		PRIMER_CARACTER_CONTROL IBI_CARGO_FURB.PRIMER_CARACTER_CONTROL%TYPE,
		SEGUN_CARACTER_CONTROL IBI_CARGO_FURB.SEGUN_CARACTER_CONTROL%TYPE,
		NUM_FIJO IBI_CARGO_FURB.NUM_FIJO%TYPE,
		CARACTER_CONTROL_N_FIJO IBI_CARGO_FURB.CARACTER_CONTROL_N_FIJO%TYPE,
		COEF_PARTICIPACION IBI_CARGO_FURB.COEF_PARTICIPACION%TYPE,
		IDENTIFICACION IBI_CARGO_FURB.IDENTIFICACION%TYPE,
		COD_PROVINCIA_INE IBI_CARGO_FURB.COD_PROVINCIA_INE%TYPE,
		COD_MUNICIPIO_INE IBI_CARGO_FURB.COD_MUNICIPIO_INE%TYPE,
		DISTRITO_CENSAL IBI_CARGO_FURB.DISTRITO_CENSAL%TYPE,
		COD_ENTIDAD_MENOR IBI_CARGO_FURB.COD_ENTIDAD_MENOR%TYPE,
		COD_VIA_PUBLICA IBI_CARGO_FURB.COD_VIA_PUBLICA%TYPE,
		TIPO_VIA IBI_CARGO_FURB.TIPO_VIA%TYPE,
		NOMBRE_VIA IBI_CARGO_FURB.NOMBRE_VIA%TYPE,
		PRIMER_NUMERO IBI_CARGO_FURB.PRIMER_NUMERO%TYPE,
		PRIMERA_LETRA IBI_CARGO_FURB.PRIMERA_LETRA%TYPE,
		SEGUNDO_NUMERO IBI_CARGO_FURB.SEGUNDO_NUMERO%TYPE,
		SEGUNDA_LETRA IBI_CARGO_FURB.SEGUNDA_LETRA%TYPE,
		KILOMETRO IBI_CARGO_FURB.KILOMETRO%TYPE,
		BLOQUE IBI_CARGO_FURB.BLOQUE%TYPE,
		TEXTO_DIRECCION IBI_CARGO_FURB.TEXTO_DIRECCION%TYPE,
		CODIGO_POSTAL IBI_CARGO_FURB.CODIGO_POSTAL%TYPE,
		ESCALERA IBI_CARGO_FURB.ESCALERA%TYPE,
		PLANTA IBI_CARGO_FURB.PLANTA%TYPE,
		PUERTA IBI_CARGO_FURB.PUERTA%TYPE,	
		NIF IBI_CARGO_FURB.NIF%TYPE,
		PERSONALIDAD IBI_CARGO_FURB.PERSONALIDAD%TYPE,
		NOMBRE IBI_CARGO_FURB.NOMBRE%TYPE,
		NUM_COMPONENTES IBI_CARGO_FURB.NUM_COMPONENTES%TYPE,	
		COMPLEMENTO_NOMBRE IBI_CARGO_FURB.COMPLEMENTO_NOMBRE%TYPE,
		COD_DEL_MEH IBI_CARGO_FURB.COD_DEL_MEH%TYPE,
		COD_MUNICIPIO_DGC IBI_CARGO_FURB.COD_MUNICIPIO_DGC%TYPE,	
		COD_PROVI_INE_FISCAL IBI_CARGO_FURB.COD_PROVI_INE_FISCAL%TYPE,
		COD_MUNI_INE_FISCAL IBI_CARGO_FURB.COD_MUNI_INE_FISCAL%TYPE,
		COD_VIA_PUBLICA_FISCAL IBI_CARGO_FURB.COD_VIA_PUBLICA_FISCAL%TYPE,
		TIPO_VIA_FISCAL IBI_CARGO_FURB.TIPO_VIA_FISCAL%TYPE,
		NOMBRE_VIA_FISCAL IBI_CARGO_FURB.NOMBRE_VIA_FISCAL%TYPE,
		PRIMER_NUMERO_FISCAL IBI_CARGO_FURB.PRIMER_NUMERO_FISCAL%TYPE,
		PRIMERA_LETRA_FISCAL IBI_CARGO_FURB.PRIMERA_LETRA_FISCAL%TYPE,
		SEGUNDO_NUMERO_FISCAL IBI_CARGO_FURB.SEGUNDO_NUMERO_FISCAL%TYPE,
		SEGUNDA_LETRA_FISCAL IBI_CARGO_FURB.SEGUNDA_LETRA_FISCAL%TYPE,
		KILOMETRO_FISCAL IBI_CARGO_FURB.KILOMETRO_FISCAL%TYPE,
		BLOQUE_FISCAL IBI_CARGO_FURB.BLOQUE_FISCAL%TYPE,
		TEXTO_DIRECCION_FISCAL IBI_CARGO_FURB.TEXTO_DIRECCION_FISCAL%TYPE,
		ESCALERA_FISCAL IBI_CARGO_FURB.ESCALERA_FISCAL%TYPE,
		PLANTA_FISCAL IBI_CARGO_FURB.PLANTA_FISCAL%TYPE,
		PUERTA_FISCAL IBI_CARGO_FURB.PUERTA_FISCAL%TYPE,
		COD_POSTAL_FISCAL IBI_CARGO_FURB.COD_POSTAL_FISCAL%TYPE,
		APARTADO_CORREOS IBI_CARGO_FURB.APARTADO_CORREOS%TYPE,		
		PAIS IBI_CARGO_FURB.PAIS%TYPE,
		PROVINCIA IBI_CARGO_FURB.PROVINCIA%TYPE,		
		MUNICIPIO_FISCAL IBI_CARGO_FURB.MUNICIPIO_FISCAL%TYPE,	
		YEAR_VALOR_CATASTRAL IBI_CARGO_FURB.YEAR_VALOR_CATASTRAL%TYPE,
		VALOR_CATASTRAL IBI_CARGO_FURB.VALOR_CATASTRAL%TYPE,
		VALOR_SUELO IBI_CARGO_FURB.VALOR_SUELO%TYPE,
		VALOR_CONSTRUCCION IBI_CARGO_FURB.VALOR_CONSTRUCCION%TYPE,
		BASE_LIQUIDABLE IBI_CARGO_FURB.BASE_LIQUIDABLE%TYPE,
		CLAVE_USO IBI_CARGO_FURB.CLAVE_USO%TYPE,
		YEAR_ULTIMA_REVISION IBI_CARGO_FURB.YEAR_ULTIMA_REVISION%TYPE,
		YEAR_ULTIMA_NOTIFICACION IBI_CARGO_FURB.YEAR_ULTIMA_NOTIFICACION%TYPE,
		NUM_ULTIMA_NOTI IBI_CARGO_FURB.NUM_ULTIMA_NOTI%TYPE,
		SUPERF_ELEM_CONSTRUCTIVOS IBI_CARGO_FURB.SUPERF_ELEM_CONSTRUCTIVOS%TYPE,
		SUPERFICIE_ELEM_SUELO IBI_CARGO_FURB.SUPERFICIE_ELEM_SUELO%TYPE,
		COEFICIENTE_FINCA IBI_CARGO_FURB.COEFICIENTE_FINCA%TYPE,
		APLICA_PRECIO_MAX_ADMIN IBI_CARGO_FURB.APLICA_PRECIO_MAX_ADMIN%TYPE,
		YEAR_FIN_PRECIO_MAX_ADMIN IBI_CARGO_FURB.YEAR_FIN_PRECIO_MAX_ADMIN%TYPE,
		TIPO_PROPIEDAD_CARGO IBI_CARGO_FURB.TIPO_PROPIEDAD_CARGO%TYPE,
		TIPO_MOVIMIENTO IBI_CARGO_FURB.TIPO_MOVIMIENTO%TYPE,
		YEAR_EXPEDIENTE IBI_CARGO_FURB.YEAR_EXPEDIENTE%TYPE,
		REF_EXPEDIENTE IBI_CARGO_FURB.REF_EXPEDIENTE%TYPE,
		EJERCICIO_ENTRADA_PADRON IBI_CARGO_FURB.EJERCICIO_ENTRADA_PADRON%TYPE,
		CLAVE_CATASTRAL_ANTERIOR IBI_CARGO_FURB.CLAVE_CATASTRAL_ANTERIOR%TYPE,
		NIF_ANTERIOR IBI_CARGO_FURB.NIF_ANTERIOR%TYPE,
		FECHA_BAJA IBI_CARGO_FURB.FECHA_BAJA%TYPE
	);

	xNIF_ANTERIOR CHAR(9);
	xPERSONALIDAD CHAR(1);
	xREGISTRO	  REG_CARGO;
      

BEGIN

	/* guardamos el anterior NIF por si éste se va a modificar en esta operación */
      SELECT NIF INTO xNIF_ANTERIOR
	FROM IBI_CARGO_FURB 
	WHERE ID=xID;


	/* modificamos (sólamente datos jurídicos) en la tabla de cargos del finurb-98 */
	UPDATE IBI_CARGO_FURB SET 
			NIF=xNIF,
			NOMBRE=xNOMBRE,
			PERSONALIDAD=xPERSONALIDAD,
			TIPO_VIA_FISCAL=xTIPO_VIA_FISCAL,
			NOMBRE_VIA_FISCAL=xNOMBRE_VIA_FISCAL,
			PRIMER_NUMERO_FISCAL=xPRIMER_NUMERO_FISCAL,
			PRIMERA_LETRA_FISCAL=xPRIMERA_LETRA_FISCAL,
			SEGUNDO_NUMERO_FISCAL=xSEGUNDO_NUMERO_FISCAL,
			SEGUNDA_LETRA_FISCAL=xSEGUNDA_LETRA_FISCAL,
			KILOMETRO_FISCAL=xKILOMETRO_FISCAL,
			BLOQUE_FISCAL=xBLOQUE_FISCAL,
			TEXTO_DIRECCION_FISCAL=xTEXTO_DIRECCION_FISCAL,
			ESCALERA_FISCAL=xESCALERA_FISCAL,
			PLANTA_FISCAL=xPLANTA_FISCAL,
			PUERTA_FISCAL=xPUERTA_FISCAL,
			COD_POSTAL_FISCAL=xCOD_POSTAL_FISCAL,
			APARTADO_CORREOS=xAPARTADO_CORREOS,
			PAIS=xPAIS,
			PROVINCIA=xPROVINCIA,
			MUNICIPIO_FISCAL=xMUNICIPIO_FISCAL
	WHERE ID=xID; 

	/* recogemos esta nueva información en una variable del tipo de registro especificado
	  anteriormente en la sección de declaraciones */

	SELECT * INTO xREGISTRO FROM IBI_CARGO_FURB WHERE ID=xID;

	/* Insertamos en la tabla VARPAD un registro que identifique esta Modificación. 
	   Indicaremos que la modificación se hace desde la Entidad Colaboradora para
	   posteriormente generar el disco a enviar a la Gerencia Territorial */

	INSERTA_VARPAD(xREGISTRO.MUNICIPIO,'51',xREGISTRO.COD_DELEGACION_MEH,
		xREGISTRO.COD_GERENCIA,xREGISTRO.COD_MUNICIPIO,xREGISTRO.REF_CATASTRAL,
      	xREGISTRO.NUM_CARGO,xREGISTRO.PRIMER_CARACTER_CONTROL,
		xREGISTRO.SEGUN_CARACTER_CONTROL,xREGISTRO.NUM_FIJO,
		xREGISTRO.CARACTER_CONTROL_N_FIJO,xREGISTRO.IDENTIFICACION,
		xREGISTRO.COEF_PARTICIPACION,xREGISTRO.COD_PROVINCIA_INE,
		xREGISTRO.COD_MUNICIPIO_INE,xREGISTRO.DISTRITO_CENSAL,xREGISTRO.COD_ENTIDAD_MENOR,
		xREGISTRO.COD_VIA_PUBLICA,xREGISTRO.TIPO_VIA,xREGISTRO.NOMBRE_VIA,
		xREGISTRO.PRIMER_NUMERO,xREGISTRO.PRIMERA_LETRA,xREGISTRO.SEGUNDO_NUMERO,
		xREGISTRO.SEGUNDA_LETRA,xREGISTRO.KILOMETRO,xREGISTRO.BLOQUE,
		xREGISTRO.TEXTO_DIRECCION,xREGISTRO.CODIGO_POSTAL,xREGISTRO.ESCALERA,
		xREGISTRO.PLANTA,xREGISTRO.PUERTA,xREGISTRO.NIF,xREGISTRO.PERSONALIDAD,
		xREGISTRO.NOMBRE,xREGISTRO.NUM_COMPONENTES,xREGISTRO.COMPLEMENTO_NOMBRE,
		xREGISTRO.COD_DEL_MEH,xREGISTRO.COD_MUNICIPIO_DGC,xREGISTRO.COD_PROVI_INE_FISCAL,
		xREGISTRO.COD_MUNI_INE_FISCAL,xREGISTRO.COD_VIA_PUBLICA_FISCAL,
		xREGISTRO.TIPO_VIA_FISCAL,xREGISTRO.NOMBRE_VIA_FISCAL,
		xREGISTRO.PRIMER_NUMERO_FISCAL,xREGISTRO.PRIMERA_LETRA_FISCAL,
		xREGISTRO.SEGUNDO_NUMERO_FISCAL,xREGISTRO.SEGUNDA_LETRA_FISCAL,
		xREGISTRO.KILOMETRO_FISCAL,xREGISTRO.BLOQUE_FISCAL,
		xREGISTRO.TEXTO_DIRECCION_FISCAL,xREGISTRO.ESCALERA_FISCAL,xREGISTRO.PLANTA_FISCAL,
		xREGISTRO.PUERTA_FISCAL,xREGISTRO.COD_POSTAL_FISCAL,xREGISTRO.APARTADO_CORREOS,
		xREGISTRO.PAIS,xREGISTRO.PROVINCIA,xREGISTRO.MUNICIPIO_FISCAL,
		xREGISTRO.YEAR_VALOR_CATASTRAL,TO_CHAR(xREGISTRO.VALOR_CATASTRAL),
		TO_CHAR(xREGISTRO.VALOR_SUELO),TO_CHAR(xREGISTRO.VALOR_CONSTRUCCION),
		TO_CHAR(xREGISTRO.BASE_LIQUIDABLE),xREGISTRO.CLAVE_USO,
		xREGISTRO.YEAR_ULTIMA_REVISION,xREGISTRO.YEAR_ULTIMA_NOTIFICACION,
		xREGISTRO.NUM_ULTIMA_NOTI,TO_CHAR(xREGISTRO.SUPERF_ELEM_CONSTRUCTIVOS),
		TO_CHAR(xREGISTRO.SUPERFICIE_ELEM_SUELO),xREGISTRO.COEFICIENTE_FINCA,
		'M',xYEAR_EXPEDIENTE,xREF_EXPEDIENTE,xCOD_ENTIDAD_COLA,'N','CV02',
		TO_CHAR(SYSDATE,'YYYYMMDD'),TO_CHAR(SYSDATE,'HH24MISS'),
		'00000000','','',xNIF_ANTERIOR,'','','00000000','0000','0000','','','A');
 

END;
/

